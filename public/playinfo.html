<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>节目单</title>
<link rel="stylesheet" href="/templets/metro/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/templets/metro/css/main.css"/>
<link rel="stylesheet" href="/templets/metro/css/icomoon.css"/>
<link rel="stylesheet" href="/templets/metro/css/menu_sideslide.css"/>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/menu-wrap.js"></script>
<script src="/js/form_request.js"></script>
<script src="/templets/metro/js/classie.js"></script>
<script src="/templets/metro/js/main.js"></script>
</head>
<body>
<div class="container">
  <div id="menu-wrap" class="menu-wrap"></div>
  <button class="menu-button" id="open-button">Open Menu</button>
  <div class="content-wrap"><div class="content">
    <nav class="navbar navbar-default"><div class="container-fluid">
      <span class="navbar-brand">节目单</span></div></nav>
    <div class="container">
      <form class="form-inline" style="margin-bottom:15px" onsubmit="loadProgram();return false;">
        <div class="form-group"><label>日期：</label><input type="text" id="pDate" class="form-control" placeholder="如 03-01"/></div>
        <button type="submit" class="btn btn-primary">查询</button>
        <button type="button" class="btn btn-default" onclick="$('#pDate').val('');loadProgram();">全部</button>
      </form>
      <div id="program"></div>
    </div>
  </div>
  <footer class="footer"><div class="container"><ul class="list-inline text-center"><li><a href="/">返回首页</a></li></ul></div></footer>
  </div>
</div>
<script>
$(function(){menu_wrap_init();loadProgram();});
function loadProgram(){
  var date=$('#pDate').val();
  $.post('/PlayinfoPage',{Date:date},function(d){
    if(!d.rows||!d.rows.length){$('#program').html('<p>暂无数据</p>');return;}
    var grouped={};
    d.rows.forEach(function(r){
      var t=r.time||'未定';
      if(!grouped[t])grouped[t]=[];
      grouped[t].push(r);
    });
    var html='';
    Object.keys(grouped).sort().forEach(function(t){
      html+='<h4>'+t+'</h4><table class="table table-bordered table-striped table-condensed"><thead><tr><th>场序</th><th>球台</th><th>项目</th><th>选手1</th><th>队伍</th><th>选手2</th><th>队伍</th><th>状态</th></tr></thead><tbody>';
      grouped[t].forEach(function(r){
        html+='<tr><td>'+r.pid+'</td><td>'+r.table_no+'</td><td>'+(r.event_title||r.key)+'</td><td>'+r.player1+'</td><td>'+r.team1+'</td><td>'+r.player3+'</td><td>'+r.team3+'</td><td>'+r.status+'</td></tr>';
      });
      html+='</tbody></table>';
    });
    $('#program').html(html);
  },'json');
}
</script>
</body>
</html>
