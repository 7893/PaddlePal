<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>队伍管理 - 赛事助手</title>
    <link rel="stylesheet" href="templets/metro/css/bootstrap.min.css">
    <style>
        .admin-nav { background: #337ab7; padding: 10px 20px; margin-bottom: 20px; }
        .admin-nav a { color: white; margin-right: 20px; }
    </style>
</head>
<body>
<div class="admin-nav">
    <a href="admin.html">管理后台</a>
    <a href="control.html">控场面板</a>
    <a href="players.html">选手管理</a>
    <a href="teams.html"><b>队伍管理</b></a>
    <a href="index.html">返回前台</a>
</div>

<div class="container">
    <h3>队伍管理 <button class="btn btn-primary btn-sm" onclick="showAdd()">+ 添加队伍</button></h3>
    
    <table class="table table-striped table-hover" id="teamTable">
        <thead><tr><th>ID</th><th>队名</th><th>简称</th><th>人数</th><th>操作</th></tr></thead>
        <tbody></tbody>
    </table>
</div>

<!-- 编辑弹窗 -->
<div class="modal fade" id="editModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" id="modalTitle">添加队伍</h4>
            </div>
            <div class="modal-body">
                <input type="hidden" id="teamId">
                <div class="form-group">
                    <label>队名</label>
                    <input type="text" class="form-control" id="teamName" required>
                </div>
                <div class="form-group">
                    <label>简称</label>
                    <input type="text" class="form-control" id="teamShort">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveTeam()">保存</button>
            </div>
        </div>
    </div>
</div>

<script src="js/jquery-3.2.1.min.js"></script>
<script src="templets/metro/js/bootstrap.min.js"></script>
<script>
function loadTeams() {
    $.get('/api/admin/teams', function(data) {
        var html = '';
        (data.teams || []).forEach(function(t) {
            html += '<tr><td>' + t.id + '</td><td>' + t.name + '</td>' +
                '<td>' + (t.short_name || '-') + '</td>' +
                '<td>' + (t.count || 0) + '</td>' +
                '<td><button class="btn btn-xs btn-info" onclick="editTeam(' + t.id + ')">编辑</button> ' +
                '<button class="btn btn-xs btn-danger" onclick="deleteTeam(' + t.id + ')">删除</button></td></tr>';
        });
        $('#teamTable tbody').html(html || '<tr><td colspan="5" class="text-center">暂无队伍</td></tr>');
    });
}

function showAdd() {
    $('#modalTitle').text('添加队伍');
    $('#teamId').val('');
    $('#teamName').val('');
    $('#teamShort').val('');
    $('#editModal').modal('show');
}

function editTeam(id) {
    $.get('/api/admin/teams?id=' + id, function(data) {
        if (data.team) {
            $('#modalTitle').text('编辑队伍');
            $('#teamId').val(data.team.id);
            $('#teamName').val(data.team.name);
            $('#teamShort').val(data.team.short_name || '');
            $('#editModal').modal('show');
        }
    });
}

function saveTeam() {
    var data = {
        id: parseInt($('#teamId').val()) || 0,
        name: $('#teamName').val(),
        short_name: $('#teamShort').val()
    };
    $.ajax({
        url: '/api/admin/teams',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(data),
        success: function(res) {
            if (res.success) {
                $('#editModal').modal('hide');
                loadTeams();
            } else {
                alert('保存失败: ' + res.error);
            }
        }
    });
}

function deleteTeam(id) {
    if (confirm('确定删除该队伍？')) {
        $.ajax({
            url: '/api/admin/teams?id=' + id,
            method: 'DELETE',
            success: function(res) {
                if (res.success) loadTeams();
                else alert('删除失败: ' + res.error);
            }
        });
    }
}

loadTeams();
</script>
</body>
</html>
