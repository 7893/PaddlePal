<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>模板下载</title>
<link rel="stylesheet" href="/templets/metro/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/templets/metro/css/main.css"/>
<style>
.template-section { margin: 20px 0; }
.template-section h4 { color: #666; border-bottom: 1px solid #eee; padding-bottom: 10px; }
.template-list { list-style: none; padding: 0; }
.template-list li { padding: 8px 0; border-bottom: 1px solid #f5f5f5; }
.template-list li:last-child { border-bottom: none; }
.template-list a { color: #337ab7; }
.template-list .size { color: #999; font-size: 12px; margin-left: 10px; }
</style>
</head>
<body>
<div class="container">
  <h3>模板下载 <small><a href="/">← 返回首页</a></small></h3>
  
  <div class="template-section">
    <h4><i class="fa fa-file-excel-o"></i> 记分单模板</h4>
    <ul id="styles" class="template-list"></ul>
  </div>
  
  <div class="template-section">
    <h4><i class="fa fa-file-excel-o"></i> 基础模板</h4>
    <ul id="templates" class="template-list"></ul>
  </div>
  
  <div class="template-section">
    <h4><i class="fa fa-file-excel-o"></i> 导入模板</h4>
    <ul id="import-templates" class="template-list"></ul>
  </div>
  
  <hr>
  
  <div class="template-section">
    <h4><i class="fa fa-download"></i> 数据导出</h4>
    <ul class="template-list">
      <li><a href="/export/all">导出全部数据 (Excel)</a></li>
    </ul>
    <div id="event-exports"></div>
  </div>
</div>

<script src="/js/jquery-3.2.1.min.js"></script>
<script>
$(function() {
  // Load templates
  $.getJSON('/templates', function(data) {
    $.each(data, function(dir, files) {
      var ul = $('#' + dir);
      if (files.length === 0) {
        ul.html('<li class="text-muted">暂无模板</li>');
      } else {
        files.forEach(function(f) {
          ul.append('<li><a href="/' + dir + '/' + encodeURIComponent(f) + '" download>' + f + '</a></li>');
        });
      }
    });
  });
  
  // Load events for export
  $.getJSON('/admin/events', function(events) {
    var html = '<ul class="template-list">';
    events.forEach(function(e) {
      html += '<li>';
      html += '<strong>' + e.title + '</strong> ';
      html += '<a href="/export/schedule/' + e.id + '">[秩序册]</a> ';
      html += '<a href="/export/results/' + e.id + '">[成绩册]</a>';
      html += '</li>';
    });
    html += '</ul>';
    $('#event-exports').html(html);
  });
});
</script>
</body>
</html>
